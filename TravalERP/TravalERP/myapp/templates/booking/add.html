
{% extends "base/base.html" %} {% block content %}

<div class="container">
  <h1 class="mt-5 title">수배등록</h1>
</div>

<div class="container mt-5">
  <form>
    {% csrf_token %}
    <div class="row">
      <label for="ref" class="col-sm-1 col-form-label">ref</label>
      <div class="col-sm-4">
        <input id="ref" type="text" class="form-control" />
      </div>
      <div class="col-sm-1"></div>
      <label for="prodName" class="col-sm-1 col-form-label">상품명</label>
      <div class="col-sm-5">
        <input id="prodName" type="text" class="form-control" />
      </div>
    </div>
    <div class="row mt-2">
      <label for="url" class="col-sm-1 col-form-label">URL</label>
      <div class="col-sm-11">
        <input id="url" type="url" class="form-control" />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row mt-2">
      <label for="agent" class="col-sm-1 col-form-label">여행사</label>
      <div class="col-sm-4">
        <select class="form-control selectpicker" aria-label="agent_name" onchange="changeAgent(this)" data-live-search="true" style="display: none;" id="agent" data-none-selected-text="조건을 찾을 수 없습니다">
          <option value="">여행사명</option>
          {% for agent in optionData.agent %}
          <!-- optionData 로 온 Object에서 agent만 선택하여 for문 돌린다-->
          <option value="{{agent.id}}">{{agent.agent_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1"></div>
      <label for="manager" class="col-sm-1 col-form-label">담당자</label>
      <div class="col-sm-4">
        <select class="form-control  selectpicker" aria-label="manager" data-live-search="true" style="display: none;" id="manager" data-none-selected-text="조건을 찾을 수 없습니다">
          <option value="">담당자명</option>
        </select>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row mt-2">
      <label for="localagent" class="col-sm-1 col-form-label">현지사무실</label>
      <div class="col-sm-4">
        <select class="form-control selectpicker" aria-label="localagent_name" onchange="changeAgent(this)" data-live-search="true" style="display: none;" id="localAgent" data-none-selected-text="조건을 찾을 수 없습니다">
          <option value="">현지사무실명</option>
          {% for agent in optionData.localAgent %}
          <option value="{{agent.id}}">{{agent.agent_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1"></div>
      <label for="localmanager" class="col-sm-1 col-form-label">담당자</label>
      <div class="col-sm-4">
        <select class="form-control  selectpicker" aria-label="localmanager" data-live-search="true" style="display: none;" id="localmanager" data-none-selected-text="조건을 찾을 수 없습니다">
          <option value="">담당자명</option>
        </select>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>AIR</p>
      <label for="kor_air_def" class="col-sm-1 col-form-label">한국출발</label>
      <div class="col-sm-2">
        <input id="kor_air_def" type="text" class="datepicker form-control" placeholder="출발일" />
      </div>
      <label for="kor_air" class="col-sm-1 col-form-label">항공편</label>
      <div class="col-sm-2">
        <select class="form-control selectpicker" id="kor_air" name="kor_air" data-live-search="true" style="display: none;" onchange="select_air(this)">
          <option value="" selected>항공편명</option>
          {% for airport in optionData.airport %}
          <option value="{{airport.id}}" data-out="{{airport.arrival_airport}}" data-in="{{airport.departure_airport}}" data-timedep="{{airport.departure_time}}" data-timearri="{{airport.arrival_time}}">{{airport.airport_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1">
        <input type="text" class="form-control" id="kor_air_in" name="kor_air_in" readonly />
      </div>
      <div class="col-sm-1">
        <input type="text" class="form-control"id="kor_air_out" name="kor_air_out"  readonly />
      </div>
      <div class="col-sm-2">
        <input type="text" class="form-control"id="kor_air_time_dep" name="kor_air_time_dep"  readonly />
      </div>
      <div class="col-sm-2">
        <input type="text" class="form-control"id="kor_air_time_arri" name="kor_air_time_arri"  readonly />
      </div>
    </div>
    <div class="row mt-2">
      <label for="loc_air_def" class="col-sm-1 col-form-label">현지출발</label>
      <div class="col-sm-2">
        <input id="loc_air_def" type="text" class="datepicker form-control" placeholder="현지출발일">
      </div>
      <label for="loc_air" class="col-sm-1 col-form-label">항공편</label>
      <div class="col-sm-2">
        <select class="form-control selectpicker" id="local_air" name="local_air" data-live-search="true" style="display: none;"  onchange="select_air(this)">
          <option value="" selected>항공편명</option>
          {% for airport in optionData.airport %}
          <option value="{{airport.id}}" data-out="{{airport.arrival_airport}}" data-in="{{airport.departure_airport}}" data-timedep="{{airport.departure_time}}" data-timearri="{{airport.arrival_time}}">{{airport.airport_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1">
        <input type="text" class="form-control" id="local_air_in" name="local_air_in" readonly />
      </div>
      <div class="col-sm-1">
        <input type="text" class="form-control" id="local_air_out" name="local_air_out" readonly />
      </div>
      <div class="col-sm-2">
        <input type="text" class="form-control"id="loc_air_time_dep" name="loc_air_time_dep"  readonly />
      </div>
      <div class="col-sm-2">
        <input type="text" class="form-control"id="loc_air_time_arri" name="loc_air_time_arri"  readonly />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>MEAL</p>
      <label for="brk" class="col-sm-1 col-form-label">조식</label>
      <div class="col-sm-2">
        <input id="brk" type="text" class="form-control" readonly />
      </div>
      <label for="lunch" class="col-sm-1 col-form-label">중식</label>
      <div class="col-sm-2">
        <input id="lunch" type="text" class="form-control" readonly />
      </div>
      <label for="dinner" class="col-sm-1 col-form-label">석식</label>
      <div class="col-sm-2">
        <input id="dinner" type="text" class="form-control" readonly />
      </div>
      <div class="col-sm-3 text-end">
        <button type="search" class="btn btn-primary">등록일정 가져오기</button>
      </div>
    </div>
    <div class="row mt-3">
      <label for="special_meal" class="col-sm-1 col-form-label">특식</label>
      <div class="col-sm-11">
        <input id="special_meal" type="text" class="form-control" style="height: 80px" readonly/>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="bus" class="col-sm-1 col-form-label">BUS</label>
      <div class="col-sm-4">
        <input id="bus" type="text" class="form-control" style="height: 80px" />
      </div>
      <div class="col-sm-1"></div>
      <label for="ent" class="col-sm-1 col-form-label">ENTRANCE</label>
      <div class="col-sm-5">
        <input id="ent" type="text" class="form-control" style="height: 80px" />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>GUIDE</p>
      <label for="kor_guide" class="col-sm-1 col-form-label">KOR</label>
      <div class="col-sm-5">
        <input id="kor_guide" type="text" class="form-control" style="height: 80px"/>
      </div>
      <label for="loc_guide" class="col-sm-1 col-form-label">LOC</label>
      <div class="col-sm-5">
        <input id="loc_guide" type="text" class="form-control" style="height: 80px"/>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>SCHDULE</p>
      <table class="table mx-3">
        <thead class="table-light">
          <tr>
            <th scope="col">일차</th>
            <th scope="col">날짜</th>
            <th scope="col">일정</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1일차</th>
            <td class="startDate"></td>
            <td>인천국제공항 출발</td>
          </tr>
          <tr>
            <th scope="row">2일차</th>
            <td>2023-03-11</td>
            <td>
              두바이공항 도착 후 환승-마드리드 도착 후 가이드 미팅-호텔이동
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="hotel" class="col-form-label">HOTEL</label>
      <div class="p-3">
        <table class="table table-centered table-nowrap mb-2 text-center">
          <thead class="table-light">
            <tr>
              <th style="width: 20px">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="customCheck1"/>
                  <label class="form-check-label" for="customCheck1">&nbsp;</label>
                </div>
              </th>
              <th class="col-sm-2">날짜</th>
              <th class="col-sm-2">지역</th>
              <th class="col-sm-1">숙박일수</th>
              <th class="col-sm-5">호텔</th>
              <th class="col-sm-2">비고</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="customCheck2"/>
                  <label class="form-check-label" for="customCheck2">&nbsp;</label>
                </div>
              </td>
              <td class="startDate"></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="customCheck2"/>
                  <label class="form-check-label" for="customCheck2">&nbsp;</label>
                </div>
              </td>
              <td class="nextDay"></td>
              <td>BCN</td>
              <td>1NT</td>
              <td>1ST 사용 기준 - 5성 1박, 파라도르 1박 사용 기준</td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="customCheck2"/>
                  <label class="form-check-label" for="customCheck2">&nbsp;</label>
                </div>
              </td>
              <td class="twoDays"></td>
              <td>VLC</td>
              <td>1NT</td>
              <td>1ST 사용 기준 - 5성 1박, 파라도르 1박 사용 기준</td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="customCheck2"/>
                  <label class="form-check-label" for="customCheck2">&nbsp;</label>
                </div>
              </td>
              <td>2023-03-13</td>
              <td>GRX</td>
              <td>1NT</td>
              <td>1ST 사용 기준 - 5성 1박, 파라도르 1박 사용 기준</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="remark" class="col-sm-1 col-form-label">REMARK</label>
      <div class="col-sm-11">
        <textarea
          id="remark"
          class="form-control"
          style="height: 100px"
        ></textarea>
      </div>
    </div>
    <div class="text-end mt-5">
      <button type="submit" class="btn btn-primary">저장</button>
      <button type="reset" class="btn btn-secondary">초기화</button>
      <button type="button" class="btn btn-secondary">취소</button>
    </div>
  </form>
</div>









<script>

  function select_air(element){
    // 선택한 option에서 data-in과 data-out 값 가져오기
    var data_in = $(element).find(':selected').data('in');
    var data_out = $(element).find(':selected').data('out');
    var data_timedep = $(element).find(':selected').data('timedep');
    var data_timearri = $(element).find(':selected').data('timearri');

    // 선택한 select box에 따라서 데이터를 적용할 input 태그 선택
    var air_in, air_out
    if (element.id === "kor_air") {
      air_in = $("#kor_air_in");
      air_out = $("#kor_air_out");
      air_timedep = $("#kor_air_time_dep");
      air_timearri = $("#kor_air_time_arri");
    } else if (element.id === "local_air") {
      air_in = $("#local_air_in");
      air_out = $("#local_air_out");
      air_timedep = $("#loc_air_time_dep");
      air_timearri = $("#loc_air_time_arri");
    }


    // input 태그에 데이터 적용
    air_in.val(data_in);
    air_out.val(data_out);
    air_timedep.val(data_timedep);
    air_timearri.val(data_timearri);
  }


  function agentChange() {
    alert("aaaa");
  }
  
  $( document ).ready(function() {
    changeAgent();
  });

  function changeAgent(element){
    $("#tmpChangeAgentFrm").remove();
    var frm = makeForm('', 'tmpChangeAgentFrm');
    var param;
    if (element.id == "agent") {
      param = $("#agent")
    }
    else{
      param = $("#localAgent")
    }

    frm.appendChild(addData('agent', param.val()));
    document.body.appendChild(frm);
    if (element.id == "agent") {
      getAjax('tmpChangeAgentFrm', 'manager', 'changeAgentSucc');
    }
    else{
      getAjax('tmpChangeAgentFrm', 'manager', 'changeLocalAgentSucc');
    }

  }

  function changeLocalAgentSucc(data){
    var select = $("#localmanager");
    select.selectpicker('destroy');
    select.empty();
    for (var i = 0; i < data.length; i++) {
        var option = $('<option>', {
            value: data[i].id,
            text: data[i].manager_name
        });
        select.append(option);
    }

    select.selectpicker();
  }

  function changeAgentSucc(data){
    var select = $("#manager");
    select.selectpicker('destroy');
    select.empty();
    for (var i = 0; i < data.length; i++) {
        var option = $('<option>', {
            value: data[i].id,
            text: data[i].manager_name
        });
        select.append(option);
    }

    select.selectpicker();   
}

  $.datepicker.setDefaults({
    dateFormat: 'yy-mm-dd',
    showOtherMonths: true,
    changeYear: true,
    changeMonth: true,
  });


  $(function() {
    $('.datepicker').datepicker({
      onSelect: function(kor_air_def) {
        var startDate = new Date(kor_air_def);
        var nextDay = startDate.setDate( startDate.getDate() + 1 );

        $('.startDate').text(kor_air_def);
        $('.nextDay').text(nextDay);

      }
    });
  });


</script>

<style>
  .devider {
    width: 100%;
    height: 5px;
    border-top: rgba(155, 151, 151, 0.979) 2px solid;
    margin: 20px 10px 20px 0px;
  }
  .title {
    font-size: 30px;
    font-weight: bolder;
    margin-bottom: 20px;
  }

  .tr_row {
    margin-bottom: 10px;
  }

  .tr_row label {
    width: 5rem;
    text-align: justify;
  }
  .tr_row input {
    width: 10rem;
    margin-right: 10px;
  }
</style>


{% endblock %} {% block js %} {{block.super}} {% endblock js %}




