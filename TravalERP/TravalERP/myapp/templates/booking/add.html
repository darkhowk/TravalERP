{% extends "base/base.html" %} {% block content %}

<div class="container">
  <h1 class="mt-5 title">수배등록</h1>
</div>

<div class="container mt-5">
  <form>
    {% csrf_token %}
    <div class="row">
      <label for="ref" class="col-sm-1 col-form-label">ref</label>
      <div class="col-sm-4">
        <input id="ref" type="text" class="form-control" />
      </div>
      <div class="col-sm-1"></div>
      <label for="prodName" class="col-sm-1 col-form-label">상품명</label>
      <div class="col-sm-5">
        <input id="prodName" type="text" class="form-control" />
      </div>
    </div>
    <div class="row mt-2">
      <label for="url" class="col-sm-1 col-form-label">URL</label>
      <div class="col-sm-11">
        <input id="url" type="url" class="form-control" />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row mt-2">
      <label for="agent" class="col-sm-1 col-form-label">여행사</label>
      <div class="col-sm-4">
        <select class="form-control selectpicker" aria-label="agent_name" onchange="changeAgent(this)" data-live-search="true" style="display: none;" id="agent">
          {% for agent in optionData.agent %}
          <!-- optionData 로 온 Object에서 agent만 선택하여 for문 돌린다-->
          <option value="{{agent.id}}">{{agent.agent_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1"></div>
      <label for="manager" class="col-sm-1 col-form-label">담당자</label>
      <div class="col-sm-4">
        <select class="form-control  selectpicker" aria-label="manager" data-live-search="true" style="display: none;" id="manager">
        </select>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row mt-2">
      <label for="localagent" class="col-sm-1 col-form-label">현지사무실</label>
      <div class="col-sm-4">
        <select class="form-control selectpicker" aria-label="localagent_name" onchange="changeAgent(this)" data-live-search="true" style="display: none;" id="localAgent">
          {% for agent in optionData.localAgent %}
          <option value="{{agent.id}}">{{agent.agent_name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-1"></div>
      <label for="localmanager" class="col-sm-1 col-form-label">담당자</label>
      <div class="col-sm-4">
        <select class="form-control  selectpicker" aria-label="localmanager" data-live-search="true" style="display: none;" id="localmanager">
        </select>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>AIR</p>
      <label for="kor_air_def" class="col-sm-1 col-form-label">한국출발</label>
      <div class="col-sm-2">
        <input id="kor_air_def" type="date" class="form-control" />
      </div>
      <label for="kor_air" class="col-sm-1 col-form-label">항공편</label>
      <div class="col-sm-2">
        <select class="form-control selectpicker" id="kor_air" name="kor_air" data-live-search="true" style="display: none;" onchange="select_air(this)">
          <option value="" selected>항공편명</option>
          {% for airport in optionData.airport %}
          <option value="{{airport.id}}" data-out="{{airport.departure_airport}}" data-in="{{airport.arrival_airport}}">{{airport.airport_name}}</option>
          {% endfor %}
        </select>
      </div>
      <label for="kor_air_in" class="col-sm-1 col-form-label">IN</label>
      <div class="col-sm-2">
        <input type="text" class="form-control" id="kor_air_in" name="kor_air_in" readonly />
      </div>
      <label for="kor_air_out" class="col-sm-1 col-form-label">OUT</label>
      <div class="col-sm-2">
        <input type="text" class="form-control"id="kor_air_out" name="kor_air_out"  readonly />
      </div>
    </div>
    <div class="row mt-2">
      <label for="loc_air_def" class="col-sm-1 col-form-label">현지출발</label>
      <div class="col-sm-2">
        <input id="loc_air_def" type="date" class="form-control" />
      </div>
      <label for="loc_air" class="col-sm-1 col-form-label">항공편</label>
      <div class="col-sm-2">
        <select class="form-control selectpicker" id="local_air" name="local_air" data-live-search="true" style="display: none;"  onchange="select_air(this)">
          <option selected>항공편명</option>
          {% for airport in optionData.airport %}
          <option value="{{airport.id}}" data-out="{{airport.departure_airport}}" data-in="{{airport.arrival_airport}}">{{airport.airport_name}}</option>
          {% endfor %}
        </select>
      </div>
      <label for="local_air_in" class="col-sm-1 col-form-label">IN</label>
      <div class="col-sm-2">
        <input type="text" class="form-control" id="local_air_in" name="local_air_in" readonly />
      </div>
      <label for="local_air_out" class="col-sm-1 col-form-label">OUT</label>
      <div class="col-sm-2">
        <input type="text" class="form-control" id="local_air_out" name="local_air_out" readonly />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="bus" class="col-sm-1 col-form-label">BUS</label>
      <div class="col-sm-4">
        <input id="bus" type="text" class="form-control" style="height: 80px" />
      </div>
      <div class="col-sm-1"></div>
      <label for="ent" class="col-sm-1 col-form-label">ENTRANCE</label>
      <div class="col-sm-5">
        <input id="ent" type="text" class="form-control" style="height: 80px" />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>MEAL</p>
      <label for="brk" class="col-sm-1 col-form-label">조식</label>
      <div class="col-sm-2">
        <input id="brk" type="text" class="form-control" readonly />
      </div>
      <label for="lunch" class="col-sm-1 col-form-label">중식</label>
      <div class="col-sm-2">
        <input id="lunch" type="text" class="form-control" readonly />
      </div>
      <label for="dinner" class="col-sm-1 col-form-label">석식</label>
      <div class="col-sm-2">
        <input id="dinner" type="text" class="form-control" readonly />
      </div>
      <div class="col-sm-3 text-end">
        <button type="search" class="btn btn-primary">검색하기</button>
      </div>
    </div>
    <div class="row mt-3">
      <label for="special_meal" class="col-sm-1 col-form-label">특식</label>
      <div class="col-sm-11">
        <input
          id="special_meal"
          type="text"
          class="form-control"
          style="height: 80px"
          readonly
        />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>GUIDE</p>
      <label for="kor_guide" class="col-sm-1 col-form-label">KOR</label>
      <div class="col-sm-5">
        <input
          id="kor_guide"
          type="text"
          class="form-control"
          style="height: 80px"
        />
      </div>
      <label for="loc_guide" class="col-sm-1 col-form-label">LOC</label>
      <div class="col-sm-5">
        <input
          id="loc_guide"
          type="text"
          class="form-control"
          style="height: 80px"
        />
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <p>SCHDULE</p>
      <table class="table mx-3">
        <thead class="table-light">
          <tr>
            <th scope="col">일차</th>
            <th scope="col">날짜</th>
            <th scope="col">일정</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1일차</th>
            <td>2023-03-10</td>
            <td>인천국제공항 출발</td>
          </tr>
          <tr>
            <th scope="row">2일차</th>
            <td>2023-03-11</td>
            <td>
              두바이공항 도착 후 환승-마드리드 도착 후 가이드 미팅-호텔이동
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="hotel" class="col-sm-1 col-form-label">HOTEL</label>
      <div class="col-sm-8">
        <input id="hotle" type="text" class="form-control" readonly />
      </div>
      <div class="col-sm-3 text-end">
        <button type="search" class="btn btn-primary">검색하기</button>
      </div>
    </div>
    <div class="devider"></div>
    <div class="row">
      <label for="remark" class="col-sm-1 col-form-label">REMARK</label>
      <div class="col-sm-11">
        <textarea
          id="remark"
          class="form-control"
          style="height: 100px"
        ></textarea>
      </div>
    </div>
    <div class="text-end mt-5">
      <button type="submit" class="btn btn-primary">저장</button>
      <button type="reset" class="btn btn-secondary">초기화</button>
      <button type="button" class="btn btn-secondary">취소</button>
    </div>
  </form>
</div>

<script>

    function select_air(element){
        // 선택한 option에서 data-in과 data-out 값 가져오기
        var data_in = $(element).find(':selected').data('in');
        var data_out = $(element).find(':selected').data('out');

        // 선택한 select box에 따라서 데이터를 적용할 input 태그 선택
        var air_in, air_out;
        if (element.id === "kor_air") {
            air_in = $("#kor_air_in");
            air_out = $("#kor_air_out");
        } else if (element.id === "local_air") {
            air_in = $("#local_air_in");
            air_out = $("#local_air_out");
        }

        // input 태그에 데이터 적용
        air_in.val(data_in);
        air_out.val(data_out);

    }

    $( document ).ready(function() {
        changeAgent();
    });

    function changeAgent(element){
        $("#tmpChangeAgentFrm").remove();
        var frm = makeForm('', 'tmpChangeAgentFrm');
        var param;
        if (element.id == "agent") {
            param = $("#agent")
        }
        else{
            param = $("#localAgent")
        }

        frm.appendChild(addData('agent', param.val()));
        document.body.appendChild(frm);
        if (element.id == "agent") {
            getAjax('tmpChangeAgentFrm', 'manager', 'changeAgentSucc');
        }
        else{
            getAjax('tmpChangeAgentFrm', 'manager', 'changeLocalAgentSucc');
        }

    }

    function changeLocalAgentSucc(data){
    var select = $("#localmanager");
    select.selectpicker('destroy');
    select.empty();
    for (var i = 0; i < data.length; i++) {
        var option = $('<option>', {
            value: data[i].id,
            text: data[i].manager_name
        });
        select.append(option);
    }

    select.selectpicker();
    }

    function changeAgentSucc(data){
    var select = $("#manager");
    select.selectpicker('destroy');
    select.empty();
    for (var i = 0; i < data.length; i++) {
        var option = $('<option>', {
            value: data[i].id,
            text: data[i].manager_name
        });
        select.append(option);
    }

    select.selectpicker();

}





</script>

<style>
    .devider {
        width: 100%;
        height: 5px;
        border-top: rgba(155, 151, 151, 0.979) 2px solid;
        margin: 20px 10px 20px 0px;
    }
    .title {
        font-size: 30px;
        font-weight: bolder;
        margin-bottom: 20px;
    }

    .tr_row {
        margin-bottom: 10px;    
    }

    .tr_row label {
        width: 5rem;
        text-align: justify;
    }
    .tr_row input {
        width: 10rem;
        margin-right: 10px;
    }
</style>

{% endblock %} {% block js %} {{block.super}} {% endblock js %}
